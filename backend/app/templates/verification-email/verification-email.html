<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Article Express</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/bootstrap.min.css') }}">
    <script src="{{ url_for('static', path='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', path='js/jquery-3.7.1.min.js') }}"></script>
</head>
<body>
    <div class="container d-flex align-items-center" style="min-height: 100vh;">
      <div class="card mx-auto" style="width: 25rem;">
        <div class="card-header text-center">
          Please verify your email
        </div>
        <div class="card-body">
          <form>
            <div class="mb-3">
                <p class="text-center">Please check your inbox for verification <br>code sent to</p>
                <p class="text-center"><strong>{{ email }}</strong></p>
            </div>
            <div class="mb-5">
                <input type="text" class="form-control" id="inputCode" aria-describedby="emailHelp" maxlength="5" style="text-align:center;">
                <div id="responseInfo" class="form-text" style="color:red;"></div>
            </div>
            <div class="mb-3">
                <button type="button" class="btn btn-dark" style="width: 100%" id="confirmBtn">Confirm</button>
            </div>
            
            <button type="button" class="btn btn-dark" style="width: 100%" id="resendCodeBtn">Resend the code</button>

          </form>
        </div>
      </div>
    </div>
    <script>
      $('#confirmBtn').click(function(){
        var feedbackInfo = document.getElementById("responseInfo");
        feedbackInfo.innerHTML = "";

        var inputValue = $('#inputCode').val();
        if (inputValue.length === 5){
          $.ajax({
            url: "http://localhost/auth/email-verification",
            type: "post",
            dataType: "json",
            contentType: "application/json",
            data: JSON.stringify({
              email_verification_token: "{{token}}",
              verification_code: inputValue
            }),
            success: function(response){
              
              window.location.href = 'http://localhost/login';
            },
            error: function(response){
              var feedbackInfo = document.getElementById("responseInfo");
              feedbackInfo.innerHTML = response.responseJSON.context.message;
            }
          })
        } else {
          var feedbackInfo = document.getElementById("responseInfo");
          feedbackInfo.innerHTML = "The code you entered is less than 5 characters!";
        }
      });
    </script>
</body>
</html>